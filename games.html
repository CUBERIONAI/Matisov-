<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Matisov X — Cyber Samurai</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

:root{
  --neon:#00d2ff;
  --bg:#02040a;
}

body{
  margin:0;
  background:radial-gradient(circle at 50% 30%, #0b2a44, var(--bg));
  color:#fff;
  font-family:'Orbitron',sans-serif;
  overflow:hidden;
}

/* ===== HEADER ===== */
header{
  position:relative;
  z-index:50;
}
.header-title{
  text-align:center;
  font-size:1.5rem;
  font-weight:900;
  margin-top:10px;
  color:var(--neon);
  text-shadow:0 0 10px var(--neon);
}

/* ===== SCENE ===== */
.viewport{
  position:relative;
  height:55vh;
  overflow:hidden;
}
.cyber-floor{
  position:absolute;
  bottom:-60%;
  left:-50%;
  width:200%;
  height:200%;
  background:
    linear-gradient(var(--neon) 1px, transparent 1px),
    linear-gradient(90deg,var(--neon) 1px, transparent 1px);
  background-size:80px 80px;
  opacity:.15;
  transform:rotateX(70deg);
}

/* ===== HERO ===== */
.hero-wrap{
  position:absolute;
  bottom:6%;
  left:50%;
  transform:translateX(-50%);
  filter:drop-shadow(0 0 40px var(--neon));
}
#hero{
  height:52vh;
  transition:transform .12s ease;
  animation:idle 3s ease-in-out infinite;
}
@keyframes idle{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-12px)}
}

/* ===== TAP FX ===== */
.tap-text{
  position:absolute;
  font-size:2.4rem;
  font-weight:900;
  color:var(--neon);
  pointer-events:none;
  animation:float .6s forwards;
  text-shadow:0 0 20px var(--neon);
}
@keyframes float{
  to{transform:translateY(-200px) scale(1.6);opacity:0}
}
.spark{
  position:absolute;
  width:5px;height:5px;
  background:var(--neon);
  border-radius:50%;
  box-shadow:0 0 10px var(--neon);
  pointer-events:none;
}

/* ===== UI PANELS ===== */
.panel{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(15px);
  border-top:1px solid rgba(0,210,255,0.3);
  padding:10px;
  display:flex;
  justify-content:space-around;
  z-index:50;
}
button{
  background:rgba(0,0,0,0.6);
  color:#00d2ff;
  font-weight:700;
  border-radius:10px;
  padding:5px 10px;
  text-align:center;
  border:1px solid #00d2ff;
}
#upgradeMenu{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.95);
  display:none;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:100;
}
.upgrade-btn{
  width:80%;
  margin:10px 0;
  padding:15px;
  font-size:1rem;
  cursor:pointer;
}

/* ENERGY BAR */
.energy-wrap{
  margin:10px;
}
.energy-bar{
  height:8px;
  background:#000;
  border-radius:10px;
  overflow:hidden;
}
.energy-fill{
  height:100%;
  background:linear-gradient(to right,#00d2ff,#00ffff);
  width:100%;
  transition:width 0.3s;
}
</style>
</head>
<body>
<header>
  <div class="header-title">Matisov X</div>
  <div class="text-center mt-2">
    <span id="bal" class="text-3xl font-black">5,046,656</span> MX
  </div>
</header>

<main class="viewport" id="tapZone">
  <div class="cyber-floor"></div>
  <div class="hero-wrap">
    <img id="hero"
      src="https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/file_0000000008b471f48ebdb6f35b1b1a5a.png">
  </div>
</main>

<div class="energy-wrap">
  <div class="flex justify-between text-xs px-4">
    <span>⚡ Energy</span>
    <span id="energyText">1000 / 1000</span>
  </div>
  <div class="energy-bar mx-4">
    <div id="energyBar" class="energy-fill"></div>
  </div>
</div>

<!-- PANEL -->
<div class="panel">
  <button onclick="toggleUpgradeMenu()">Upgrades</button>
  <button onclick="inviteFriend()">Invite Friend</button>
</div>

<!-- UPGRADE MENU -->
<div id="upgradeMenu">
  <button class="upgrade-btn" id="tapUpgrade" onclick="buyUpgrade('tap')">Tap Power Lv.1 - 5000 MX</button>
  <button class="upgrade-btn" id="energyUpgrade" onclick="buyUpgrade('energy')">Hyper Arms Lv.1 - 5000 MX</button>
  <button class="upgrade-btn" id="aiUpgrade" onclick="buyUpgrade('ai')">AI Magic Lv.1 - 10000 MX</button>
  <button class="upgrade-btn" onclick="toggleUpgradeMenu()">Close</button>
</div>

<script>
Telegram.WebApp.expand();

// ======================
// GAME CONFIG
// ======================
const cfg={tap:12,maxE:1000,regen:3};

// ======================
// GAME STATE
// ======================
let state={
  bal:parseInt(localStorage.getItem('mx_bal'))||5046656,
  e:1000,
  upgrades:{tap:{level:1,cost:5000},energy:{level:1,cost:5000},ai:{level:1,cost:10000}},
  referralBonus:25000,
  referrals:JSON.parse(localStorage.getItem('referrals'))||[]
};

// ======================
// ELEMENTS
// ======================
const hero=document.getElementById('hero');
const zone=document.getElementById('tapZone');

// ======================
// TAP EVENT
// ======================
zone.addEventListener('touchstart',tap,{passive:false});
zone.addEventListener('mousedown',tap);

function tap(e){
  e.preventDefault();
  if(state.e<cfg.tap)return;

  const x=e.touches?e.touches[0].clientX:e.clientX;
  const y=e.touches?e.touches[0].clientY:e.clientY;

  state.e-=cfg.tap;
  let totalTap=cfg.tap+state.upgrades.tap.level*5;

  for(let i=0;i<state.upgrades.ai.level;i++){
    totalTap+=cfg.tap;
    renderTapEffect(x+i*10,y-i*10,cfg.tap);
  }

  state.bal+=totalTap;
  hero.style.transform="scale(.9) rotate(-3deg)";
  setTimeout(()=>hero.style.transform="",120);

  renderTapEffect(x,y,cfg.tap);

  Telegram.WebApp.HapticFeedback?.impactOccurred("medium");
  updateUI();
  localStorage.setItem('mx_bal',state.bal);
}

// ======================
// TAP EFFECTS
// ======================
function renderTapEffect(x,y,amount){
  const txt=document.createElement('div');
  txt.className='tap-text';
  txt.style.left=x+'px';
  txt.style.top=y+'px';
  txt.textContent='+'+amount+' MX';
  document.body.appendChild(txt);
  setTimeout(()=>txt.remove(),600);

  for(let i=0;i<8;i++){
    const s=document.createElement('div');
    s.className='spark';
    s.style.left=x+'px';
    s.style.top=y+'px';
    document.body.appendChild(s);
    const dx=(Math.random()-.5)*300;
    const dy=(Math.random()-.5)*300;
    s.animate([{transform:'translate(0,0)',opacity:1},{transform:`translate(${dx}px,${dy}px)`,opacity:0}],
      {duration:500}).onfinish=()=>s.remove();
  }
}

// ======================
// UI UPDATE
// ======================
function updateUI(){
  document.getElementById('bal').textContent=state.bal.toLocaleString();
  document.getElementById('energyText').textContent=`${state.e} / ${cfg.maxE}`;
  document.getElementById('energyBar').style.width=(state.e/cfg.maxE*100)+'%';
  document.getElementById('tapUpgrade').textContent=`Tap Power Lv.${state.upgrades.tap.level} - ${state.upgrades.tap.cost} MX`;
  document.getElementById('energyUpgrade').textContent=`Hyper Arms Lv.${state.upgrades.energy.level} - ${state.upgrades.energy.cost} MX`;
  document.getElementById('aiUpgrade').textContent=`AI Magic Lv.${state.upgrades.ai.level} - ${state.upgrades.ai.cost} MX`;
}

// ======================
// UPGRADE LOGIC
// ======================
function buyUpgrade(type){
  const up=state.upgrades[type];
  if(state.bal>=up.cost){
    state.bal-=up.cost;
    up.level+=1;
    up.cost=Math.floor(up.cost*1.6);
    localStorage.setItem('mx_bal',state.bal);
    updateUI();
  } else alert("Not enough MX");
}

function toggleUpgradeMenu(){
  const m=document.getElementById('upgradeMenu');
  m.style.display=(m.style.display==='flex')?'none':'flex';
}

// ======================
// REFERRAL SYSTEM
// ======================
function inviteFriend(){
  const refId=prompt("Enter friend ID to claim referral:");
  if(refId) claimReferral(refId);
}
function claimReferral(refId){
  if(!state.referrals.includes(refId)){
    state.bal+=state.referralBonus;
    state.referrals.push(refId);
    localStorage.setItem('mx_bal',state.bal);
    localStorage.setItem('referrals',JSON.stringify(state.referrals));
    alert(`Referral claimed! +${state.referralBonus} MX`);
    updateUI();
  }
}

// ======================
// ENERGY REGEN
// ======================
setInterval(()=>{
  if(state.e<cfg.maxE){state.e=Math.min(cfg.maxE,state.e+cfg.regen);updateUI();}
},1000);

updateUI();
</script>
</body>
</html>
