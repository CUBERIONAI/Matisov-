<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Matisov X — Cyber Samurai</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

:root{
  --neon:#00d2ff;
  --bg:#02040a;
}

body{
  margin:0;
  background:radial-gradient(circle at 50% 30%, #0b2a44, var(--bg));
  color:#fff;
  font-family:'Orbitron',sans-serif;
  overflow:hidden;
}

/* ===== HEADER ===== */
header{
  padding:1.5rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#gameTitle{
  font-size:1.8rem;
  font-weight:900;
  color:var(--neon);
}

/* ===== SCENE ===== */
.viewport{
  position:relative;
  height:60vh;
  overflow:hidden;
}
.cyber-floor{
  position:absolute;
  bottom:-60%;
  left:-50%;
  width:200%;
  height:200%;
  background:
    linear-gradient(var(--neon) 1px, transparent 1px),
    linear-gradient(90deg,var(--neon) 1px, transparent 1px);
  background-size:80px 80px;
  opacity:.15;
  transform:rotateX(70deg);
}

/* ===== HERO ===== */
.hero-wrap{
  position:absolute;
  bottom:6%;
  left:50%;
  transform:translateX(-50%);
  filter:drop-shadow(0 0 40px var(--neon));
}
#hero{
  height:52vh;
  transition:transform .12s ease;
  animation:idle 3s ease-in-out infinite;
}
@keyframes idle{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-12px)}
}

/* ===== TAP FX ===== */
.tap-text{
  position:absolute;
  font-size:2.4rem;
  font-weight:900;
  color:var(--neon);
  pointer-events:none;
  animation:float .6s forwards;
  text-shadow:0 0 20px var(--neon);
}
@keyframes float{
  to{transform:translateY(-200px) scale(1.6);opacity:0}
}
.spark{
  position:absolute;
  width:5px;height:5px;
  background:var(--neon);
  border-radius:50%;
  box-shadow:0 0 10px var(--neon);
  pointer-events:none;
}

/* ===== ENERGY BAR ===== */
.energy-container{
  padding:1.5rem;
}
.energy-bar-bg{
  height:0.75rem;
  background:#000;
  border-radius:999px;
  overflow:hidden;
}
.energy-bar-fill{
  height:100%;
  background:linear-gradient(to right,#00d2ff,#1e90ff);
  width:100%;
  transition:width .3s;
}

/* ===== UPGRADES MENU ===== */
#upgradeMenu{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  backdrop-filter:blur(10px);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:50;
  display:none;
}
#upgradeMenu .panel{
  background:rgba(20,20,20,.95);
  padding:2rem;
  border-radius:2rem;
  width:90%;
  max-width:400px;
  position:relative;
  display:flex;
  flex-direction:column;
  gap:1rem;
}
#upgradeMenu h2{
  color:var(--neon);
  text-align:center;
  font-size:1.5rem;
  font-weight:900;
}
.upgrade-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(40,40,40,.5);
  padding:.75rem 1rem;
  border-radius:1rem;
}
.upgrade-item p:first-child{
  font-weight:700;
}
.upgrade-btn{
  background:var(--neon);
  color:#000;
  font-weight:700;
  padding:.5rem 1rem;
  border-radius:1rem;
}
#closeUpgrade{
  position:absolute;
  top:0.5rem;
  right:0.5rem;
  font-size:1.5rem;
  color:red;
  cursor:pointer;
}

/* OPEN UPGRADE BUTTON */
#openUpgrade{
  position:fixed;
  bottom:5rem;
  right:1.5rem;
  z-index:40;
  background:var(--neon);
  padding:1rem 1.5rem;
  border-radius:999px;
  font-weight:900;
  color:#000;
}
</style>
</head>
<body>

<header>
  <div>
    <div id="gameTitle">Matisov X</div>
    <div class="text-xs text-blue-400 uppercase tracking-widest mt-1">Network Balance</div>
    <div class="text-3xl font-black italic">
      <span id="bal">5,046,656</span> <span class="text-blue-400 text-xl">MX</span>
    </div>
  </div>
  <div class="px-4 py-1 border border-blue-400/40 rounded-full text-xs">
    STAGE 2 — SAMURAI
  </div>
</header>

<main class="viewport" id="tapZone">
  <div class="cyber-floor"></div>
  <div class="hero-wrap">
    <img id="hero" src="https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/file_0000000008b471f48ebdb6f35b1b1a5a.png">
  </div>
</main>

<div class="energy-container">
  <div class="flex justify-between text-xs mb-1">
    <span>⚡ Energy</span>
    <span id="energyText">1000 / 1000</span>
  </div>
  <div class="energy-bar-bg">
    <div id="energyBar" class="energy-bar-fill"></div>
  </div>
</div>

<!-- UPGRADES MENU -->
<div id="upgradeMenu">
  <div class="panel">
    <h2>Upgrades</h2>

    <div class="upgrade-item">
      <div>
        <p>Hyper Cyber Hands</p>
        <p class="text-xs text-gray-300">Increase Max Energy</p>
      </div>
      <button class="upgrade-btn" data-type="energy">Buy (<span id="cost-energy">10k</span> MX)</button>
    </div>

    <div class="upgrade-item">
      <div>
        <p>Sword Power</p>
        <p class="text-xs text-gray-300">Increase Tap Power</p>
      </div>
      <button class="upgrade-btn" data-type="tap">Buy (<span id="cost-tap">10k</span> MX)</button>
    </div>

    <div class="upgrade-item">
      <div>
        <p>AI Magic</p>
        <p class="text-xs text-gray-300">Activate Multi-Tap Bonus</p>
      </div>
      <button class="upgrade-btn" data-type="ai">Buy (<span id="cost-ai">50k</span> MX)</button>
    </div>

    <div id="closeUpgrade">✕</div>
  </div>
</div>

<button id="openUpgrade">Upgrades</button>

<script>
Telegram.WebApp.expand();

// ===== GAME CONFIG =====
const cfg = {
  tap:12,
  maxE:1000,
  regen:3
};

// ===== STATE =====
let st = {
  bal:parseInt(localStorage.getItem('mx_bal')) || 5046656,
  e:parseInt(localStorage.getItem('mx_energy')) || 1000
};

// ===== HERO & TAP =====
const hero=document.getElementById('hero');
const zone=document.getElementById('tapZone');

zone.addEventListener('touchstart',tap,{passive:false});
zone.addEventListener('mousedown',tap);

function tap(e){
  e.preventDefault();
  if(st.e<cfg.tap)return;

  const x = e.touches ? e.touches[0].clientX : e.clientX;
  const y = e.touches ? e.touches[0].clientY : e.clientY;

  st.e -= cfg.tap;
  st.bal += cfg.tap;

  hero.style.transform="scale(.9) rotate(-3deg)";
  setTimeout(()=>hero.style.transform="",120);

  // Tap FX
  const txt=document.createElement('div');
  txt.className='tap-text';
  txt.style.left=x+'px';
  txt.style.top=y+'px';
  txt.textContent='+'+cfg.tap+' MX';
  document.body.appendChild(txt);
  setTimeout(()=>txt.remove(),600);

  for(let i=0;i<8;i++){
    const s=document.createElement('div');
    s.className='spark';
    s.style.left=x+'px';
    s.style.top=y+'px';
    document.body.appendChild(s);

    const dx=(Math.random()-.5)*300;
    const dy=(Math.random()-.5)*300;
    s.animate([{transform:'translate(0,0)',opacity:1},{transform:`translate(${dx}px,${dy}px)`,opacity:0}],
              {duration:500}).onfinish=()=>s.remove();
  }

  Telegram.WebApp.HapticFeedback?.impactOccurred("medium");
  updateUI();
  saveProgress();
}

// ===== ENERGY REGEN =====
setInterval(()=>{
  if(st.e<cfg.maxE){
    st.e=Math.min(cfg.maxE,st.e+cfg.regen);
    updateUI();
    saveProgress();
  }
},1000);

// ===== UI =====
function updateUI(){
  document.getElementById('bal').textContent=st.bal.toLocaleString();
  document.getElementById('energyText').textContent=`${st.e} / ${cfg.maxE}`;
  document.getElementById('energyBar').style.width=(st.e/cfg.maxE*100)+'%';
}

// ===== SAVE PROGRESS =====
function saveProgress(){
  localStorage.setItem('mx_bal', st.bal);
  localStorage.setItem('mx_energy', st.e);
}

// ===== UPGRADES LOGIC =====
const upgrades = {
  energy:{level:0,cost:10000,step:5000},
  tap:{level:0,cost:10000,step:5000},
  ai:{level:0,cost:50000,step:25000}
};

const upgradeMenu = document.getElementById('upgradeMenu');
document.getElementById('openUpgrade').addEventListener('click', ()=>upgradeMenu.style.display='flex');
document.getElementById('closeUpgrade').addEventListener('click', ()=>upgradeMenu.style.display='none');
upgradeMenu.addEventListener('click', (e)=>{ if(e.target===upgradeMenu) upgradeMenu.style.display='none'; });

document.querySelectorAll('.upgrade-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const type = btn.dataset.type;
    const u = upgrades[type];
    if(st.bal<u.cost){ alert('Not enough MX'); return; }
    st.bal-=u.cost;
    u.level+=1;
    u.cost+=u.step;

    // APPLY EFFECTS
    if(type==='energy') cfg.maxE+=50;
    if(type==='tap') cfg.tap+=2;
    if(type==='ai') cfg.aiMulti=(cfg.aiMulti||1)+0.5;

    // UPDATE COST DISPLAY
    document.getElementById(`cost-${type}`).textContent=u.cost.toLocaleString();
    updateUI();
    saveProgress();
  });
});

updateUI();
</script>

</body>
</html>
