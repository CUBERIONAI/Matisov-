<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Matisov X | Cyber Samurai</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap');

body { 
    margin: 0;
    font-family: 'Orbitron', sans-serif; 
    overflow: hidden; 
    user-select: none; 
    /* –§–æ–Ω —Å–∞–º–æ—ó –≥—Ä–∏ */
    background: url('https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/game-background.png') no-repeat center center; 
    background-size: cover;
    color: white;
}

.samurai-box {
    position: relative;
    width: 100%;
    height: 45vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden; /* –Ω—ñ—á–æ–≥–æ –∑–∞–π–≤–æ–≥–æ */
    background: none; /* –ø—Ä–æ–∑–æ—Ä–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
}

#samurai {
    display: block;
    max-height: 100%;
    z-index: 2;
    transition: transform 0.1s ease;
}

.mx-popup {
    position: absolute; color: #00d2ff; font-weight: 900; font-size: 32px;
    pointer-events: none; animation: floatUp 0.7s forwards; z-index: 100;
    text-shadow: 0 0 10px #00d2ff;
}

@keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-150px); opacity: 0; } }

.energy-bar { height: 12px; background: #111; border-radius: 6px; border: 1px solid #222; overflow: hidden; }
.energy-fill { height: 100%; background: linear-gradient(90deg, #00d2ff, #0055ff); transition: width 0.2s; box-shadow: 0 0 15px #00d2ff; }

.nav-btn.active { color: #00d2ff; text-shadow: 0 0 10px #00d2ff; }
.screen { display: none; height: calc(100vh - 180px); overflow-y: auto; }
.active-screen { display: block; }
</style>
</head>
<body class="flex flex-col h-screen p-4">

<audio id="sfx-hit" src="https://assets.mixkit.co/active_storage/sfx/1077/1077-preview.mp3"></audio>

<header class="flex justify-between items-start mb-4">
<div>
<p class="text-[10px] text-gray-500 uppercase cyber-font">Balance</p>
<div class="flex items-center gap-2">
<span id="balance" class="text-4xl font-black italic">0</span>
<span class="text-blue-500 font-bold">MX</span>
</div>
</div>
<div class="text-right">
<p id="rank" class="text-[10px] text-blue-400 font-bold uppercase">Stage 1</p>
<p class="text-[8px] text-gray-600 italic">1M MX = 1 Coin</p>
</div>
</header>

<main class="flex-1">
<section id="game-screen" class="screen active-screen">
<div class="samurai-box" id="tap-target">
    <img id="samurai" src="https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/1770305168681.png" alt="Samurai">
</div>

<div class="mt-8 px-4">
<div class="flex justify-between text-[10px] mb-2 font-bold tracking-widest text-blue-300">
<span>‚ö° ENERGY</span>
<span id="energy-text">1000/1000</span>
</div>
<div class="energy-bar">
<div id="energy-fill" class="energy-fill" style="width: 100%"></div>
</div>
</div>
</section>

<section id="tasks-screen" class="screen p-2">
<h2 class="text-xl font-bold mb-4 text-blue-400">Missions (+1M MX)</h2>
<div id="task-list" class="space-y-3"></div>
</section>
</main>

<footer class="h-20 bg-[#0a0a0c] border border-gray-900 rounded-3xl flex justify-around items-center mb-4">
<button onclick="nav('game')" class="nav-btn active flex flex-col items-center">
<span class="text-2xl">‚öîÔ∏è</span><span class="text-[10px] font-bold">FIGHT</span>
</button>
<button onclick="nav('tasks')" class="nav-btn flex flex-col items-center">
<span class="text-2xl">üéÅ</span><span class="text-[10px] font-bold">EARN</span>
</button>
<button class="nav-btn flex flex-col items-center opacity-40">
<span class="text-2xl">üë•</span><span class="text-[10px] font-bold">FRENS</span>
</button>
</footer>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let balance = parseInt(localStorage.getItem('mx_bal')) || 0;
let energy = 1000;
let tapPower = 1;

// --- –ö–∞–¥—Ä–æ–≤–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è –≥–µ—Ä–æ—è ---
const samuraiFrames = [
"https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/1770305168681.png",
"https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/1770305191748.png",
"https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/1770305246186.png",
"https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/1770305263574.png"
];
let frameIndex = 0;
const samurai = document.getElementById('samurai');
const tapTarget = document.getElementById('tap-target');
const sfxHit = document.getElementById('sfx-hit');

tapTarget.addEventListener('touchstart', (e) => {
    e.preventDefault();
    if (energy >= tapPower) {
        const touch = e.touches[0];
        balance += tapPower;
        energy -= tapPower;

        // –ó–º—ñ–Ω–∞ –∫–∞–¥—Ä—É –≥–µ—Ä–æ—è
        frameIndex = (frameIndex + 1) % samuraiFrames.length;
        samurai.src = samuraiFrames[frameIndex];
        samurai.style.transform = "scale(1.1)";
        setTimeout(() => samurai.style.transform = "scale(1)", 100);

        // –ó–≤—É–∫ —ñ –ø–æ–ø–∞–ø
        sfxHit.currentTime = 0;
        sfxHit.play();
        showPopup(touch.clientX, touch.clientY);

        if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        updateUI();
        save();
    }
});

function showPopup(x, y) {
    const p = document.createElement('div');
    p.className = 'mx-popup';
    p.style.left = x + 'px'; p.style.top = y + 'px';
    p.innerText = `+${tapPower}`;
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 700);
}

function updateUI() {
    document.getElementById('balance').innerText = balance.toLocaleString();
    document.getElementById('energy-text').innerText = `${energy}/1000`;
    document.getElementById('energy-fill').style.width = (energy/10) + '%';
    const rank = document.getElementById('rank');
    if(balance >= 10000000) rank.innerText = "Stage 3 (Shogun)";
    else if(balance >= 1000000) rank.innerText = "Stage 2 (Samurai)";
}

// --- –ó–∞–≤–¥–∞–Ω–Ω—è ---
const missions = [
    { n: "TG Channel", r: 1000000, l: "https://t.me/Matisov_X" },
    { n: "TG Chat", r: 1000000, l: "https://t.me/MatisovX" },
    { n: "YouTube", r: 1000000, l: "https://www.youtube.com/@MatisovX" },
    { n: "Instagram", r: 1000000, l: "https://www.instagram.com/matisov.x" },
    { n: "Twitter X", r: 1000000, l: "https://x.com/matisovx" }
];

function initTasks() {
    const list = document.getElementById('task-list');
    missions.forEach(m => {
        list.innerHTML += `
        <div class="bg-[#111] p-4 rounded-2xl flex justify-between items-center border border-gray-800">
            <div><p class="text-sm font-bold">${m.n}</p><p class="text-xs text-blue-400">+1,000,000 MX</p></div>
            <button onclick="doTask('${m.l}', ${m.r})" class="bg-blue-600 px-4 py-2 rounded-xl text-[10px] font-black uppercase">Go</button>
        </div>`;
    });
}

function doTask(url, reward) {
    window.open(url, '_blank');
    setTimeout(() => {
        balance += reward;
        updateUI();
        save();
        tg.showAlert("Mission Complete! +1,000,000 MX");
    }, 3000);
}

// --- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è ---
function nav(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id + '-screen').classList.add('active-screen');
    event.currentTarget.classList.add('active');
}

function save() { 
    localStorage.setItem('mx_bal', balance); 
    localStorage.setItem('mx_time', Date.now()); 
}

// –û—Ñ–ª–∞–π–Ω –¥–æ—Ö—ñ–¥
function checkOffline() {
    const last = localStorage.getItem('mx_time');
    if(last) {
        const hours = Math.min(8, (Date.now() - last) / 3600000);
        if(hours > 0.1) {
            const earned = Math.floor(hours * 5000);
            balance += earned;
            tg.showAlert(`AI Bot collected ${earned} MX while you were away!`);
        }
    }
}

setInterval(() => { 
    if(energy < 1000) { 
        energy = Math.min(1000, energy + 2); 
        updateUI(); 
    } 
}, 1000);

initTasks();
checkOffline();
updateUI();
</script>
</body>
</html>
